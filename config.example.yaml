# EdgeQuota Configuration Example
# Copy to /etc/edgequota/config.yaml or set EDGEQUOTA_CONFIG_FILE.

server:
  address: ":8080"
  read_timeout: "30s"
  write_timeout: "30s"
  idle_timeout: "120s"
  drain_timeout: "30s"
  # max_websocket_conns_per_key: 100   # Max concurrent WS connections per rate-limit key (0=unlimited)
  # Optional TLS termination. Required for HTTP/3.
  # Certificates are hot-reloaded when the file changes on disk.
  # tls:
  #   enabled: true
  #   cert_file: "/etc/edgequota/tls/cert.pem"
  #   key_file: "/etc/edgequota/tls/key.pem"
  #   http3_enabled: true   # Serve HTTP/3 (QUIC) on the same address over UDP
  #   min_version: "1.2"    # Minimum TLS version: "1.2" (default) or "1.3"

admin:
  address: ":9090"
  read_timeout: "5s"
  write_timeout: "10s"
  idle_timeout: "30s"

backend:
  url: "http://my-backend:8080"
  timeout: "30s"
  max_idle_conns: 100
  idle_conn_timeout: "90s"
  # tls_insecure_skip_verify: false

  # Low-level HTTP transport tuning. All values have sensible defaults.
  transport:
    dial_timeout: "30s"             # TCP dial timeout for backend connections
    dial_keep_alive: "30s"          # TCP keep-alive interval
    tls_handshake_timeout: "10s"    # TLS handshake timeout
    expect_continue_timeout: "1s"   # Expect: 100-continue timeout
    h2_read_idle_timeout: "30s"     # HTTP/2 read idle timeout (gRPC)
    h2_ping_timeout: "15s"          # HTTP/2 ping timeout (gRPC)
    websocket_dial_timeout: "10s"   # WebSocket backend dial timeout

# Optional external authentication.
# auth:
#   enabled: true
#   timeout: "5s"
#   http:
#     url: "http://auth-service:8080/check"

rate_limit:
  average: 100          # Requests per period.
  burst: 50             # Maximum burst.
  period: "1s"
  failure_policy: "passThrough"  # passThrough | failClosed | inMemoryFallback
  # min_ttl: ""          # Optional floor for Redis key TTL (e.g. "10s"). Reduces EXPIRE churn.
  key_strategy:
    type: "clientIP"    # clientIP | header | composite
    # header_name: "X-Tenant-Id"
    # path_prefix: false
    # trusted_proxies:   # CIDRs whose X-Forwarded-For / X-Real-IP are trusted.
    #   - "10.0.0.0/8"  # When empty (default), only RemoteAddr is used.
    # trusted_ip_depth: 0  # Which XFF entry to use: 0=leftmost, N=Nth from right.

redis:
  endpoints:
    - "redis:6379"
  mode: "single"        # single | replication | sentinel | cluster
  pool_size: 10
  dial_timeout: "5s"
  read_timeout: "3s"
  write_timeout: "3s"

logging:
  level: "info"
  format: "json"

# Optional OpenTelemetry tracing.
# tracing:
#   enabled: true
#   endpoint: "http://otel-collector:4318"
#   service_name: "edgequota"
#   sample_rate: 0.1
